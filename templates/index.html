{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-0">
  <div class="d-flex flex-column flex-lg-row" style="height: calc(100vh - 112px);">

    <!-- MAPA -->
    <div id="map-container" class="flex-fill position-relative order-1 order-lg-0">
      <div id="map" class="w-100 h-100"></div>
      <button id="btn-registrar" class="btn btn-primary shadow fw-semibold">
        Registrar buraco
      </button>
    </div>

    <!-- PAINEL DE REGISTRO -->
    <div id="painel-registro"
         class="bg-white border-top border-lg-start shadow-sm order-0 order-lg-1 d-flex flex-column"
         style="width: 100%; max-width: 400px; overflow-y: auto; transition: transform 0.3s ease;">

      <div class="p-4 flex-shrink-0">
        <h5 class="fw-semibold text-primary mb-3">üï≥Ô∏è Registrar novo buraco</h5>

        <div class="alert alert-info small mb-4">
          <strong>Como registrar:</strong><br>
          1Ô∏è‚É£ Clique em <strong>‚ÄúRegistrar buraco‚Äù</strong>.<br>
          2Ô∏è‚É£ No mapa, d√™ <strong>dois cliques</strong> (ou toques) no local.<br>
          3Ô∏è‚É£ Preencha o formul√°rio abaixo e anexe uma <strong>foto</strong>.<br>
          4Ô∏è‚É£ Finalize clicando em <strong>‚ÄúSalvar ocorr√™ncia‚Äù</strong>.
        </div>
      </div>

      <form id="form-register"
            class="needs-validation flex-grow-1 d-flex flex-column px-4 pb-4"
            novalidate enctype="multipart/form-data">

        <div class="mb-3">
          <label for="title" class="form-label">T√≠tulo</label>
          <input type="text" id="title" name="title" class="form-control" required>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Descri√ß√£o</label>
          <textarea id="description" name="description" class="form-control" rows="3"></textarea>
        </div>

        <div class="mb-3">
          <label for="image" class="form-label">Foto (opcional)</label>
          <input type="file" id="image" name="image" class="form-control" accept="image/*">
          <div class="mt-2 text-center" id="preview-container" style="display:none;">
            <img id="image-preview" src="#" alt="Pr√©-visualiza√ß√£o"
                 class="img-fluid rounded border p-1" style="max-height:180px;">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label for="lat" class="form-label">Latitude</label>
            <input type="text" id="lat" name="lat" class="form-control" readonly required>
          </div>
          <div class="col">
            <label for="lng" class="form-label">Longitude</label>
            <input type="text" id="lng" name="lng" class="form-control" readonly required>
          </div>
        </div>

        <button type="submit" class="btn btn-success w-100 fw-semibold mt-auto">
          üíæ Salvar ocorr√™ncia
        </button>
        <div id="msg" class="mt-3"></div>
      </form>
    </div>
  </div>
</div>

<style>
  /* ===== BOT√ÉO FIXO ===== */
  #btn-registrar {
    position: fixed;
    top: 90px;
    right: 20px;
    z-index: 1100;
    border-radius: 8px;
  }

  /* ===== MAPA ===== */
  #map {
    width: 100%;
    height: 100%;
    min-height: 400px;
  }

  /* ===== DESKTOP ===== */
  @media (min-width: 992px) {
    #painel-registro {
      height: 100%;
      max-height: calc(100vh - 112px);
      overflow-y: auto;
      transform: translateX(0);
    }
  }

  /* ===== MOBILE ===== */
  @media (max-width: 991.98px) {
    #painel-registro {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 55%;
      border-top: 3px solid #0d6efd;
      transform: translateY(100%);
      box-shadow: 0 -4px 10px rgba(0,0,0,0.15);
      background: #fff;
      z-index: 1050;
    }
    #painel-registro.open {
      transform: translateY(0);
    }
    #btn-registrar {
      bottom: 57%;
      top: auto;
    }
  }

  /* ===== SCROLL PERSONALIZADO ===== */
  #painel-registro::-webkit-scrollbar {
    width: 8px;
  }
  #painel-registro::-webkit-scrollbar-thumb {
    background-color: #bbb;
    border-radius: 4px;
  }
  #painel-registro::-webkit-scrollbar-thumb:hover {
    background-color: #888;
  }
</style>
{% endblock %}
